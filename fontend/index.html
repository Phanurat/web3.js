<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airdrop Claim</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
</head>

<body>
    <h1>Claim Your Airdrop</h1>
    <button id="connectWallet">Connect Wallet</button>
    <p id="walletAddress"></p>
    <button id="claimAirdrop" disabled>Claim Airdrop</button>
    <p id="status"></p>

    <script>
        // ข้อมูลของ Airdrop Contract
        const airdropAbi =
            [
                {
                    "inputs": [],
                    "name": "claimAirdrop",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_tokenAddress",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [],
                    "name": "airdropAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "hasClaimed",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "token",
                    "outputs": [
                        {
                            "internalType": "contract IMyToken",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            ;
        const airdropContractAddress = '0xBE511686Fc55A8ed0D66484F356279B1c589F462'; // ที่อยู่ของ Airdrop Contract

        let provider;
        let signer;
        let airdropContract;

        // ฟังก์ชันการเชื่อมต่อกระเป๋า Metamask
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    // ขอให้ผู้ใช้เชื่อมต่อกระเป๋า
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();

                    const userAddress = await signer.getAddress();
                    document.getElementById('walletAddress').innerText = `Connected: ${userAddress}`;

                    // เปิดใช้งานปุ่ม Claim
                    document.getElementById('claimAirdrop').disabled = false;

                    // เชื่อมต่อกับ Contract
                    airdropContract = new ethers.Contract(airdropContractAddress, airdropAbi, signer);
                } catch (error) {
                    console.error("Error connecting to Metamask:", error);
                    document.getElementById('status').innerText = "Error connecting to Metamask";
                }
            } else {
                alert('Please install Metamask!');
            }
        }

        // ฟังก์ชันสำหรับ Claim Airdrop
        async function claimAirdrop() {
            try {
                const tx = await airdropContract.claimAirdrop();
                document.getElementById('status').innerText = "Transaction sent! Waiting for confirmation...";
                await tx.wait(); // รอการยืนยันธุรกรรม
                document.getElementById('status').innerText = "Airdrop claimed successfully!";
            } catch (error) {
                console.error("Error claiming airdrop:", error);
                document.getElementById('status').innerText = `Error: ${error.message}`;
            }
        }

        // ตั้งค่า event listeners
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('claimAirdrop').addEventListener('click', claimAirdrop);
    </script>
</body>

</html>